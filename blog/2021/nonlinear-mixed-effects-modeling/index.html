<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Nonlinear Mixed-Effects Modeling | Jongmin Mun</title> <meta name="author" content="Jongmin Mun"> <meta name="description" content="An overview of Nonlinear Mixed-Effects Models (NLME), their structure, and workflow using SimBiology."> <meta name="keywords" content="Jongmin Mun, USC"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?v=1772219719"> <link rel="canonical" href="https://jong-min-moon.github.io/blog/2021/nonlinear-mixed-effects-modeling/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Nonlinear Mixed-Effects Modeling",
      "description": "An overview of Nonlinear Mixed-Effects Models (NLME), their structure, and workflow using SimBiology.",
      "published": "November 10, 2021",
      "authors": [
        {
          "author": "Jong Min Moon",
          "authorURL": "https://github.com/Jong-Min-Moon",
          "affiliations": [
            {
              "name": "Yonsei University",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Jongmin </span>Mun</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Study</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/coursework/">Coursework</a> <a class="dropdown-item" href="/study/papers/">Papers</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Posts<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill "> <d-title> <h1>Nonlinear Mixed-Effects Modeling</h1> <p>An overview of Nonlinear Mixed-Effects Models (NLME), their structure, and workflow using SimBiology.</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#repeated-measurement-in-pharmacokinetics">Repeated Measurement in Pharmacokinetics</a></div> <div><a href="#the-goal-of-population-pk-modeling">The Goal of Population PK Modeling</a></div> <div><a href="#need-for-mixed-effects-models">Need for Mixed-Effects Models</a></div> <div><a href="#mixed-effect-modeling-in-population-pk">Mixed-Effect Modeling in Population PK</a></div> <div><a href="#general-nlme-model-structure">General NLME Model Structure</a></div> <div><a href="#modeling-workflow">Modeling Workflow</a></div> </nav> </d-contents> <h2 id="repeated-measurement-in-pharmacokinetics">Repeated Measurement in Pharmacokinetics</h2> <p>Pharmacokinetics (PK) is the study of how the body handles a drug over time—specifically its absorption, distribution, metabolism, and excretion. It essentially characterizes “what the body does to the drug.” Since these biological processes are dynamic, drug handling is not instantaneous; it evolves over time. Consequently, we must measure drug concentration at multiple time points to fully understand the PK profile.</p> <p>Let’s define our variables:</p> <ul> <li>Let $i=1, \ldots, N$ denote the subject index.</li> <li>Let $j=1, \ldots, n_i$ denote the time point index for the $i$-th subject.</li> <li>$y_{ij}$ represents the measured drug concentration for the $i$-th subject at time $t_{ij}$.</li> </ul> <p>Our basic dataset consists of these repeated measurements: $(y_{ij}, t_{ij})$.</p> <h2 id="population-pk-modeling-b">Population PK Modeling b</h2> <p>The primary goals of population PK modeling are twofold:</p> <ol> <li> <strong>Describe the Trajectory</strong>: Determine how the drug concentration $y_{ij}$ changes as a function of time $t_{ij}$. This requires the main modeling.</li> <li> <strong>Explain Variability</strong>: Understand how individual characteristics influence this trajectory. This requires modifying the main modeling just a little bit.</li> </ol> <p>To address the first goal, we need a structural model. A common choice for PK data is the exponential decay function, as many drugs are eliminated from the body in an exponential fashion after distribution. A basic one-compartment model can be described as:</p> \[y_{ij} = \frac{D_i}{V} e^{-k_i t_{ij}} + \epsilon_{ij}\] <p>Here:</p> <p>$D_i$ is the dose administered to the $i$-th individual.</p> <p>$V$ is the <strong>Volume of Distribution</strong>, which represents the apparent volume into which the drug distributes (think of it as the “tank size”). A small $V$ (e.g., 3–5 L) suggests the drug remains in the bloodstream, while a large $V$ implies extensive tissue binding, making the apparent volume much larger than the body itself.</p> <p>$k_i$ is the <strong>Elimination Rate</strong>, which determines how fast the drug is removed.</p> <p>$\epsilon_{ij} \sim N(0, \sigma^2)$ represents measurement error.</p> <p>The elimination rate $k_i$ is often parameterized as the ratio of <strong>Clearance</strong> ($Cl_i$) to Volume ($V$): \(k_i = \frac{Cl_i}{V}\) where $Cl_i$ represents the volume of blood cleared of the drug per unit time (think of it as “blood cleaning speed”). Note that $k_i$ and $Cl_i$ are patient-specific parameters, allowing for individual variability.</p> <h2 id="need-for-mixed-effects-models">Need for Mixed-Effects Models</h2> <p>In repeated measurement data, observations from the same individual ($y_{i1}, y_{i2}, \dots$) are correlated, violating the independence assumption of standard regression models.</p> <p>To handle this, we have two extreme approaches:</p> <ol> <li> <strong>Pool all data</strong>: Fit a single regression model to all data points, ignoring individual correlations. This obscures important inter-individual differences.</li> <li> <strong>Individual fits</strong>: Fit a separate regression model for each individual. This requires a large number of data points per subject, which is often unavailable in clinical trials or sparse biological datasets.</li> </ol> <p><strong>Mixed-effects models</strong> offer a compromise. They recognize correlations within sample subgroups (individuals) and allow us to make broad inferences on population-wide parameters (fixed effects) while estimating individual-specific deviations (random effects). This approach allows for robust estimation even with sparse data per subject.</p> <h2 id="mixed-effect-modeling-in-population-pk">Mixed-Effect Modeling in Population PK</h2> <p>To model the biological variation between individuals, we treat parameters like clearance ($Cl$) as random variables that vary around a population mean.</p> <p>We split the parameter into a <strong>fixed effect</strong> (population mean) and a <strong>random effect</strong> (individual deviation). For the $i$-th individual, we can model clearance as:</p> \[Cl_i = \theta_{Cl} + \eta_i\] <ul> <li>$\theta_{Cl}$: Fixed effect (the typical clearance value for the population).</li> <li>$\eta_i$: Random effect (the specific deviation for subject $i$).</li> </ul> <p>We typically assume deviations are normally distributed: $\eta_i \sim N(0, \sigma^2_\eta)$. This formulation allows us to capture heterogeneity without estimating a completely free parameter for every individual.</p> <h3 id="incorporating-covariates">Incorporating Covariates</h3> <p>We can further refine the model by adding individual-specific covariates (e.g., weight, age, renal function) to explain some of the inter-individual variability. Ideally, this reduces the unexplained variance in the random effect.</p> <p>For example, if clearance is related to weight ($w_i$), we can expand the model:</p> \[Cl_i = \theta_{Cl} + \theta_{wt} \cdot w_i + \eta_i\] <p>Here, $\theta_{wt}$ is the fixed effect quantifying the relationship between weight and clearance.</p> <h2 id="general-nlme-model-structure">General NLME Model Structure</h2> <p>A general Nonlinear Mixed-Effects (NLME) model can be mathematically formulated as follows:</p> \[y_{ij} = f(x_{ij}, p_i) + \epsilon_{ij} \\ p_i = A_i \theta + B_i \eta_i \\ \epsilon_{ij} \sim N(0, \sigma^2) \\ \eta_i \sim N(0, \Psi)\] <p>Where:</p> <ul> <li>$y_{ij}$: Response vector (e.g., drug concentration).</li> <li>$f(\cdot)$: Nonlinear function governing the process (e.g., the PK compartmental equations).</li> <li>$p_i$: Vector of individual-specific parameters (e.g., $Cl_i, V_i$).</li> <li>$\theta$: Vector of fixed effects (population parameters).</li> <li>$\eta_i$: Vector of random effects, assumed $\eta_i \sim MVN(0, \Psi)$.</li> <li>$A_i, B_i$: Design matrices linking covariates and random effects to individual parameters.</li> <li>$\Psi$: Covariance matrix quantifying the between-subject variability.</li> <li>$\sigma^2$: Residual error variance.</li> </ul> <h2 id="modeling-workflow">Modeling Workflow</h2> <p>Estimating these models involves determining the fixed effects $\theta$, the random effect covariance $\Psi$, and residual variance $\sigma^2$. Software like MATLAB’s <strong>SimBiology</strong> facilitates this process using Maximum Likelihood Estimation.</p> <p>A typical workflow involves:</p> <ol> <li> <strong>Import &amp; Format</strong>: Load data and convert to <code class="language-plaintext highlighter-rouge">groupedData</code> format.</li> <li> <strong>Structural Model</strong>: Define the compartmental model (e.g., distribution and elimination kinetics).</li> <li> <strong>Covariate Model</strong>: Specify relationships between parameters and covariates (e.g., Weight on Clearance).</li> <li> <strong>Error Model</strong>: Choose an error structure (Constant, Proportional, or Combined) for $\epsilon_{ij}$.</li> <li> <strong>Estimation</strong>: Use algorithms (like FOCE, stochastic EM) to maximize the likelihood function: \(p(y | \theta, \sigma^2, \Psi) = \int p(y | \theta, \eta, \sigma^2) p(\eta | \Psi) \, d\eta\)</li> </ol> <p>This approach allows for rigorous quantification of drug behavior across populations, supporting dose optimization and clinical decision-making.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2026 Jongmin Mun. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>